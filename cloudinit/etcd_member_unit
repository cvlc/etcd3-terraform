[Unit]
Description=etcd key-value store
Documentation=https://github.com/etcd-io/etcd
After=network.target etcd-bootstrap.service

[Service]
User=etcd
Type=notify
Environment="ETCD_DATA_DIR=/var/lib/etcd"
Environment="ETCD_INITIAL_ADVERTISE_PEER_URLS=http://${peer_name}.${discovery_domain_name}:2380"
Environment="ETCD_INITIAL_CLUSTER_TOKEN=${cluster_name}"
Environment="ETCD_ADVERTISE_CLIENT_URLS=http://${peer_name}.${discovery_domain_name}:2379"
Environment="ETCD_LISTEN_CLIENT_URLS=http://0.0.0.0:2379"
Environment="ETCD_LISTEN_PEER_URLS=http://0.0.0.0:2380"
Environment="ETCD_STRICT_RECONFIG_CHECK=true"
Environment="ETCD_HEARTBEAT_INTERVAL=500"
Environment="ETCD_ELECTION_TIMEOUT=5000"
Environment="ETCD_MAX_SNAPSHOTS=10"
Environment="ETCD_MAX_WALS=10"
Environment="ETCD_QUOTA_BACKEND_BYTES=8589934592"
Environment="ETCD_SNAPSHOT_COUNT=100000"
Environment="ETCD_AUTO_COMPACTION_RETENTION=20000"
Environment="ETCD_AUTO_COMPACTION_MODE=revision"
Environment="ETCD_NAME=${peer_name}"
Environment="ETCD_INITIAL_CLUSTER_STATE=new"
Environment="ETCD_DISCOVERY_SRV=${discovery_domain_name}"
ExecStart=
ExecStart=/usr/local/bin/etcd
Restart=always
RestartSec=10s
LimitNOFILE=40000

[Install]
WantedBy=multi-user.target
